<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NCD（中野区診療所データベース）入力サイト</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="js/scripts.js" defer></script>
</head>
<body class="flex flex-col min-h-screen bg-gray-50 text-gray-800">

  <!-- ヘッダー -->
  <header class="bg-blue-900 text-white shadow">
    <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-xl md:text-2xl font-bold tracking-wide">NCD 入力システム</h1>
      <span class="text-sm md:text-base opacity-80">中野区診療所データベース</span>
    </div>
  </header>

  <!-- メイン -->
  <main class="flex-1 max-w-4xl mx-auto px-6 py-12">
    <h2 class="text-2xl md:text-3xl font-bold text-center mb-8 text-blue-800">
      中野区診療所の先生方へ  
    </h2>
    <p class="text-center text-gray-700 mb-12">
      このサイトは、中野区医師会の先生方にご自身の診療所情報をご入力いただき、<br>
      「中野区診療所データベース（NCD）」を構築するためのものです。<br>
      登録内容は地域医療連携や紹介先検索に活用されます。
    </p>

    <!-- 操作カード -->
    <div class="grid md:grid-cols-3 gap-6">
      <!-- 新規登録 -->
      <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition flex flex-col items-center text-center">
        <h3 class="text-lg font-semibold mb-3 text-blue-800">新規登録</h3>
        <p class="text-gray-600 mb-6">はじめて入力する先生はこちら</p>
        <a href="register.html"
           class="bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-800 transition">
          新規診療所を登録
        </a>
      </div>

      <!-- 施設選択 -->
      <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition flex flex-col items-center text-center">
        <h3 class="text-lg font-semibold mb-3 text-blue-800">施設選択</h3>
        <p class="text-gray-600 mb-6">既に登録済みの診療所を選び、<br>入力を続けられます</p>
        <a href="clinicList.html"
           class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
          施設を選択
        </a>
      </div>

      <!-- 管理画面 -->
      <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition flex flex-col items-center text-center">
        <h3 class="text-lg font-semibold mb-3 text-blue-800">管理画面</h3>
        <p class="text-gray-600 mb-6">登録状況の確認やマスター管理</p>
        <a href="admin.html"
           class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 transition">
          管理ダッシュボード
        </a>
      </div>
    </div>

    <!-- 読み込みエリア -->
    <div id="main" class="mt-12"></div>
  </main>

  <!-- フッター -->
  <footer class="bg-blue-900 text-white text-center py-4 mt-auto">
    <p class="text-sm">© 2025 中野区医師会 - Nakano Clinic Database</p>
  </footer>

  <!-- 追加スクリプト: サーバー⇔localStorage同期 -->
  <script>
    async function syncClinics() {
      try {
        const res = await fetch("/api/listClinics"); // 修正済み
        if (!res.ok) return;
        const serverClinics = await res.json();

        // localStorage の既存データ
        const localClinics = JSON.parse(localStorage.getItem("clinics") || "[]");

        // ID が重複しないようにマージ
        const merged = [
          ...localClinics,
          ...serverClinics.filter(s => !localClinics.find(l => l.id === s.id))
        ];

        // 保存
        localStorage.setItem("clinics", JSON.stringify(merged));
        console.log("診療所データを同期:", merged);

      } catch (err) {
        console.error("診療所データ同期エラー:", err);
      }
    }

    // ページ読み込み時に同期
    syncClinics();
  </script>

</body>
</html>