<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>共通マスター管理ハブ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  
<script>window.NCD_CF_ENV=window.__CF_PAGES_ENV||(window.__CF_PAGES_ENV?{NCD_API_BASE:window.__CF_PAGES_ENV.NCD_API_BASE,ENV_LABEL:window.__CF_PAGES_ENV.ENV_LABEL}:{NCD_API_BASE:'https://ncd-app.altry.workers.dev',ENV_LABEL:'production'});</script>
<script src="../js/env.js"></script>

  <script src="../js/auth.js" defer></script>
  <script src="../js/sessionGuard.js" defer></script>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col" data-require-role="systemRoot,masterAdmin" data-guard-message="共通マスター管理者専用ページです。トップページへ戻ります。">
  <header class="bg-gradient-to-r from-slate-900 via-blue-900 to-slate-900 text-white shadow">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between gap-3">
      <a href="/index.html" class="inline-flex items-center gap-2 rounded bg-white/10 px-3 py-2 text-sm font-semibold tracking-wide transition hover:bg-white/20">
        <span aria-hidden="true">⌂</span>
        Top
      </a>
      <h1 class="text-lg font-semibold tracking-wide">共通マスター管理ハブ</h1>
      <div class="flex items-center gap-2">
        <span class="hidden sm:inline text-sm text-white/80">Nakano Clinic Database</span>
        <button id="adminLogout" class="inline-flex items-center gap-2 rounded bg-white/10 px-3 py-2 text-xs font-semibold tracking-wide transition hover:bg-red-500/80 hover:text-white">
          <span class="hidden sm:inline">ログアウト</span>
          <span class="sm:hidden">退出</span>
        </button>
      </div>
    </div>
  </header>

  <main class="flex-1">
    <section class="border-b border-slate-200 bg-white/70">
      <div class="max-w-6xl mx-auto px-4 py-6">
        <p class="text-sm text-slate-600">
          全国共通で利用するマスター（診療/検査/資格/部位 等）の整備用ハブです。自治体単位の運用や厚労省インポートはシステム管理ハブから実行してください。
        </p>
        <div class="mt-3 text-xs text-slate-500">
          <a href="/admin/systemHub.html" data-admin-link data-required-role="systemRoot" class="inline-flex items-center gap-2 rounded border border-white/40 bg-slate-900/70 px-3 py-1.5 font-semibold text-white shadow hover:bg-slate-900/90 transition text-sm">
            システム管理ハブへ
          </a>
        </div>
      </div>
    </section>

    <div class="max-w-6xl mx-auto px-4 py-8 space-y-10">
      <section>
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-base font-semibold text-blue-900">診療所・標榜診療科</h2>
        </div>
        <div class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
          <a href="/categoriesAdmin.html?type=department" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">標榜診療科分類マスター</h3>
            <p class="mt-2 text-sm text-slate-600">標榜診療科で利用する分類ラベルを追加・改名・削除します。</p>
          </a>
          <a href="clinicModes.html" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">診療形態マスター</h3>
            <p class="mt-2 text-sm text-slate-600">オンライン診療・夜間診療などの診療形態タグを管理し、公開可否や表示順を調整します。</p>
          </a>
        </div>
      </section>

      <section>
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-base font-semibold text-blue-900">個人資格・医療分野</h2>
        </div>
        <div class="grid gap-4 sm:grid-cols-2">
          <a href="personalQualifications.html" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">個人資格マスター</h3>
            <p class="mt-2 text-sm text-slate-600">分類・医療分野・名称・学会名を編集し、承認ステータスを管理します。</p>
          </a>
          <a href="societyMaster.html" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">学会マスター</h3>
            <p class="mt-2 text-sm text-slate-600">分類ごとの学会名を整理し、個人資格入力時の候補を管理します。</p>
          </a>
          <a href="/categoriesAdmin.html?type=qual" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">医療分野マスター</h3>
            <p class="mt-2 text-sm text-slate-600">個人資格で利用する医療分野カテゴリを管理します。</p>
          </a>
        </div>
      </section>

      <section>
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-base font-semibold text-blue-900">施設認定・種類マスター</h2>
        </div>
        <div class="grid gap-4 sm:grid-cols-2">
          <a href="facilityAccreditations.html" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">施設認定マスター</h3>
            <p class="mt-2 text-sm text-slate-600">種類・名称・備考を管理し、候補から承認までの状態を操作します。</p>
          </a>
          <a href="/categoriesAdmin.html?type=facility" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">施設認定種類マスター</h3>
            <p class="mt-2 text-sm text-slate-600">施設認定で使用する種類カテゴリを登録・整理します。</p>
          </a>
        </div>
      </section>

      <section>
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-base font-semibold text-blue-900">検査マスター・検査分類</h2>
        </div>
        <div class="grid gap-4 sm:grid-cols-2">
          <a href="testsMaster.html" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">検査マスター</h3>
            <p class="mt-2 text-sm text-slate-600">検査名称の一覧管理・検索・CSV入出力を行います。</p>
          </a>
          <a href="/categoriesAdmin.html?type=test" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">検査分類マスター</h3>
            <p class="mt-2 text-sm text-slate-600">検査マスターで使用する分類ラベルを編集します。</p>
          </a>
        </div>
      </section>

      <section>
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-base font-semibold text-blue-900">症状・部位マスター</h2>
        </div>
        <div class="grid gap-4 sm:grid-cols-2">
          <a href="symptomMaster.html" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">症状マスター</h3>
            <p class="mt-2 text-sm text-slate-600">症状の基礎情報や対応部位・推奨診療／検査を編集します。</p>
          </a>
          <a href="bodySiteMaster.html" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">部位マスター</h3>
            <p class="mt-2 text-sm text-slate-600">解剖部位の階層・患者向け名称・別名を管理し、症状との紐付けに備えます。</p>
          </a>
        </div>
      </section>

      <section>
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-base font-semibold text-blue-900">診療マスター・診療分類</h2>
        </div>
        <div class="grid gap-4 sm:grid-cols-2">
          <a href="servicesMaster.html" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">診療マスター</h3>
            <p class="mt-2 text-sm text-slate-600">診療メニューの分類・名称・説明を管理します。</p>
          </a>
          <a href="/categoriesAdmin.html?type=service" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">診療分類マスター</h3>
            <p class="mt-2 text-sm text-slate-600">診療マスターで使用する分類ラベルを管理します。</p>
          </a>
        </div>
      </section>

      <section>
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-base font-semibold text-blue-900">予防接種・健診マスター</h2>
        </div>
        <div class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
          <a href="vaccinationMaster.html" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">予防接種マスター</h3>
            <p class="mt-2 text-sm text-slate-600">ワクチン種類別に名称・詳細を整理します。</p>
          </a>
          <a href="/categoriesAdmin.html?type=vaccinationType" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">予防接種種類マスター</h3>
            <p class="mt-2 text-sm text-slate-600">予防接種で利用する種類ラベルを管理します。</p>
          </a>
          <a href="checkupMaster.html" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">健診マスター</h3>
            <p class="mt-2 text-sm text-slate-600">健診種類別の名称・詳細を整理します。</p>
          </a>
          <a href="/categoriesAdmin.html?type=checkupType" class="group block rounded-xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:border-blue-400 hover:shadow-lg">
            <h3 class="text-base font-semibold text-slate-900">健診種類マスター</h3>
            <p class="mt-2 text-sm text-slate-600">健診に使用する種類ラベルを管理します。</p>
          </a>
        </div>
      </section>

    </div>
  </main>

  <footer class="bg-slate-900/90 text-slate-100">
    <div class="max-w-6xl mx-auto flex flex-col gap-2 px-4 py-4 text-sm md:flex-row md:items-center md:justify-between">
      <div>© 2025 中野区医師会 Nakano Clinic Database</div>
      <div class="flex gap-4">
        <a href="/terms.html" class="text-sky-300 underline hover:text-sky-200">利用規約</a>
        <a href="/privacy.html" class="text-sky-300 underline hover:text-sky-200">プライバシーポリシー</a>
      </div>
    </div>
  </footer>
  <script>
    (function setupAdminLogout(global) {
      const DEFAULT_API_BASE = 'https://ncd-app.altry.workers.dev';

      function resolveApiBase() {
        if (global.NcdAuth && typeof global.NcdAuth.resolveApiBase === 'function') {
          return global.NcdAuth.resolveApiBase();
        }
        return DEFAULT_API_BASE;
      }

      async function executeLogout() {
        const apiBase = resolveApiBase();
        const auth = global.NcdAuth?.getStoredAuth?.();
        const payload = auth?.tokens ? {
          refreshToken: auth.tokens.refreshToken,
          sessionId: auth.tokens.sessionId,
        } : {};
        try {
          await fetch(`${apiBase}/api/auth/logout`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          });
        } catch (error) {
          console.warn('[adminLogout] logout request failed', error);
        } finally {
          try {
            global.NcdAuth?.clearAuth?.();
          } catch (_) {}
          global.location.replace('/index.html');
        }
      }

      function init() {
        const button = document.getElementById('adminLogout');
        if (!button) return;
        button.addEventListener('click', () => {
          button.disabled = true;
          executeLogout();
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init, { once: true });
      } else {
        init();
      }
    })(window);
  </script>
</body>
</html>
