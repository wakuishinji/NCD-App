# Agent 運用ルール（和久井さん ↔ Codex）

セッションが切り替わってもスムーズに作業を再開できるよう、Codex が守るべき運用ルールとコミュニケーション方針をまとめる。本書は和久井さん（systemRoot）と Codex の合意事項であり、変更があれば必ずここを更新する。

---

## 1. コミュニケーション基本
- やり取りはすべて **日本語**。専門用語は必要に応じて併記しつつ、背景も簡潔に説明する。  
- レスポンスには、依頼の理解状況・実施可否・次アクションを明確に記載する。  
- 和久井さんの指示が曖昧な場合は、作業前に必ず確認する。推測で進めない。  
- 作業後は変更内容・影響範囲・未実行テストの理由を必ず共有し、必要に応じて次の確認事項を提示する。
- 将来のリスクや改善案に気付いたら、可能な範囲で先読み提案を行い、その合意事項を本ドキュメントへ記録する。

## 2. 日常の作業フロー
1. **状況把握**: セッション開始時・大きな依頼前には `docs/roadmap.md` と本 `agent.md` を読み直し、最新の方針を確認する。  
2. **変更前確認**: `git status -sb` でローカル差分を確認し、既存の未コミット変更がある場合は影響を洗い出す。  
3. **作業計画**: 3ステップ以上になるタスクは `update_plan` を使って簡潔な計画を共有する。  
4. **実装**: 指示された範囲のみ変更。不要なリファクタ・追加変更は事前合意なしに行わない。  
5. **コミット & Push**: 作業を完了したら `git add` → `git commit` → `git push` を実行。Push が成功するまでは完了報告しない。  
   - Push 後はサーバーが自動で `git pull` する運用になっているため、原則として作業の締めくくりに push まで必ず実施する。  
   - 仕上がりに強い不安がある場合のみ push を保留し、その旨を共有して和久井さんにローカル検証（または追加確認）を依頼する。  
6. **共有**: 変更概要、実行/未実行テスト、確認してほしい点を「簡潔に」報告。必要であれば roadmap 更新有無も記載。  
7. **次アクション確認**: 和久井さんの反応を待ち、追加指示がなければ次の作業に進まない。

## 3. コード・ドキュメント編集ポリシー
- 既存の指針（署名がある設定ファイルや Secrets 管理など）は `docs/roadmap.md` や会話内容を優先する。  
- 文言変更やリネームの際は、差分で分かりやすいコミットメッセージを付与。  
- ドキュメントを新規追加・大幅改訂した場合は、関連箇所（他ドキュメントや参照リンク）の追従を確認。  
- 自動生成ファイルやビルド成果物はコミットしない。必要に応じて `.gitignore` を更新する。

## 4. テスト・確認
- 和久井さんからテスト実行指示がある場合は最優先で対応し、結果をログ付きで報告。  
- テスト環境が不明・不足している場合は、どのテストが実行できないか理由と代替策を提示する。  
- 本番相当の確認が必要な操作（例: Secrets 更新、危険なデータ移行）は必ず事前合意を取る。

## 5. セキュリティ・本番運用
- API キーやシークレット情報はローカル・会話に出さない。扱う必要がある作業は必ず和久井さんに確認。  
- 本番設定変更（Cloudflare、DNS、Secrets）は和久井さんの指示があるときのみ実施。  
- 破壊的操作（大量削除、スキーマ変更、マイグレーション）は手順書を作成したうえで確認を得る。  
- 作業途中で異常（意図しない差分・ログエラー）を検出した場合は即報告し、指示を待つ。

## 6. ドキュメント構成ルール
- **`docs/roadmap.md`**: 全体ビジョン、現在までの開発状況、ブランド/ドメイン戦略、優先タスクを記載。更新後はコミット+Push。  
- **`agent.md`**: 本ルール集。新たな運用方針や作法が決まったら必ず追記し、和久井さんと共有。  
- その他詳細設計・Runbook は必要に応じて別ドキュメントへ切り出し、roadmap から参照する。

## 7. 想定しているロール
- 和久井さん（`systemRoot`）の指示が最優先。疑義や判断が必要な場合は都度相談。  
- Codex は実装・ドキュメント更新・検証を担当し、判断が必要な事項は提案ベースで提示する。  
- 将来的に他メンバーが参加した際は、ここに役割と連絡線を追記する。

---

このドキュメントは生きたルールブックである。新しい合意事項があれば、必ず `agent.md` を更新し `docs/roadmap.md` と整合させたうえでコミット・Pushする。必要に応じて履歴から変更理由を追えるよう、コミットメッセージは簡潔かつ明確に記載する。
